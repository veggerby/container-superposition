# Web API Stack Preset
# Complete environment for REST/GraphQL API development

id: web-api
name: Web API Stack
description: Complete REST/GraphQL API development environment with database, cache, and observability
type: meta
category: preset
supports: [compose] # Requires Docker Compose for services
tags: [preset, api, web, backend, observability]

# Overlays to select
selects:
    # Always included
    required: []

    # User makes choices
    userChoice:
        language:
            id: language
            prompt: Select API language/framework
            options: [dotnet, nodejs, python, go, java]
            defaultOption: nodejs

# Parameterized slots - users can customize these without micro-managing individual overlays
parameters:
    database:
        description: 'Primary data store'
        default: postgres
        options:
            - id: postgres
              overlays: [postgres]
              description: 'PostgreSQL relational database'
            - id: mongodb
              overlays: [mongodb]
              description: 'MongoDB document database'
            - id: mysql
              overlays: [mysql]
              description: 'MySQL relational database'
            - id: none
              overlays: []
              description: 'No database (manage separately)'

    cache:
        description: 'In-memory cache'
        default: redis
        options:
            - id: redis
              overlays: [redis]
              description: 'Redis cache and session store'
            - id: none
              overlays: []
              description: 'No cache'

    broker:
        description: 'Message broker (optional)'
        default: none
        options:
            - id: rabbitmq
              overlays: [rabbitmq]
              description: 'RabbitMQ AMQP message broker'
            - id: nats
              overlays: [nats]
              description: 'NATS lightweight messaging'
            - id: redpanda
              overlays: [redpanda]
              description: 'Redpanda Kafka-compatible streaming'
            - id: none
              overlays: []
              description: 'No message broker'

    observability:
        description: 'Monitoring and observability stack'
        default: standard
        options:
            - id: minimal
              overlays: []
              description: 'No observability tools'
            - id: standard
              overlays: [prometheus, grafana]
              description: 'Metrics and dashboards'
            - id: full
              overlays: [otel-collector, prometheus, grafana, loki]
              description: 'Full stack - metrics, logs, and traces'

# Glue configuration - integration helpers
glueConfig:
    # Suggested port mappings (actual ports depend on chosen overlays)
    portMappings:
        api: 8000
        grafana: 3000
        prometheus: 9090

    # README snippet to add to generated devcontainer
    readme: |
        ## Web API Stack

        This devcontainer is configured for web API development. The exact services depend
        on the parameters you chose (database, cache, broker, observability).

        ### Connection Strings

        Connection strings for each service are defined in `.devcontainer/.env.example`.
        Copy that file to `.env` and adjust values as needed:

        ```bash
        cd .devcontainer
        cp .env.example .env
        ```

        ### Quick Start

        1. Start your API (default suggested port: 8000)
        2. Access Grafana at http://localhost:3000 (admin/admin) — if observability was enabled
        3. View metrics in Prometheus at http://localhost:9090 — if observability was enabled

        ### Health Checks

        Verify all services are running:

        ```bash
        docker-compose ps
        ```

        ### Next Steps

        - Configure your API to use the connection strings from `.env`
        - Add OpenTelemetry SDK to your application (if full observability was selected)
        - Create custom Grafana dashboards for your API metrics
