{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://container-superposition.dev/schema/overlay-manifest.json",
    "title": "Overlay Manifest",
    "description": "Metadata for a Container Superposition overlay",
    "type": "object",
    "required": ["id", "name", "description", "category"],
    "properties": {
        "id": {
            "type": "string",
            "description": "Unique identifier for the overlay (must match directory name)",
            "pattern": "^[a-z0-9-]+$"
        },
        "name": {
            "type": "string",
            "description": "Human-readable name for display in UI"
        },
        "description": {
            "type": "string",
            "description": "One-line summary of what this overlay provides"
        },
        "category": {
            "type": "string",
            "description": "Category grouping for the overlay",
            "enum": ["language", "database", "observability", "cloud", "dev", "preset"]
        },
        "supports": {
            "type": "array",
            "description": "Which base templates this overlay works with (empty = all)",
            "items": {
                "type": "string",
                "enum": ["plain", "compose"]
            },
            "default": []
        },
        "requires": {
            "type": "array",
            "description": "Hard dependencies that must be automatically installed",
            "items": {
                "type": "string"
            },
            "default": []
        },
        "suggests": {
            "type": "array",
            "description": "Recommended overlays that work well together",
            "items": {
                "type": "string"
            },
            "default": []
        },
        "conflicts": {
            "type": "array",
            "description": "Overlays that cannot be used together",
            "items": {
                "type": "string"
            },
            "default": []
        },
        "tags": {
            "type": "array",
            "description": "Keywords for search and filtering",
            "items": {
                "type": "string",
                "pattern": "^[a-z0-9-]+$"
            },
            "default": []
        },
        "ports": {
            "type": "array",
            "description": "Ports used by the overlay (for offset calculation and documentation)",
            "items": {
                "oneOf": [
                    {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 65535,
                        "description": "Simple port number (legacy format)"
                    },
                    {
                        "type": "object",
                        "description": "Rich port metadata with service info and connection details",
                        "required": ["port"],
                        "properties": {
                            "port": {
                                "type": "integer",
                                "minimum": 1,
                                "maximum": 65535,
                                "description": "Port number"
                            },
                            "service": {
                                "type": "string",
                                "description": "Service name (e.g., postgres, grafana, jaeger)",
                                "pattern": "^[a-z0-9-]+$"
                            },
                            "protocol": {
                                "type": "string",
                                "description": "Protocol type",
                                "enum": ["http", "https", "tcp", "udp", "grpc"]
                            },
                            "description": {
                                "type": "string",
                                "description": "Human-readable description of what this port is for"
                            },
                            "path": {
                                "type": "string",
                                "description": "Default path for HTTP/HTTPS services (e.g., /, /metrics)",
                                "pattern": "^/"
                            },
                            "onAutoForward": {
                                "type": "string",
                                "description": "VS Code port auto-forward behavior",
                                "enum": ["notify", "openBrowser", "openPreview", "silent", "ignore"]
                            },
                            "connectionStringTemplate": {
                                "type": "string",
                                "description": "Template for connection string (e.g., postgresql://{user}:{password}@{host}:{port}/{database})"
                            }
                        },
                        "additionalProperties": false
                    }
                ]
            },
            "default": []
        },
        "order": {
            "type": "integer",
            "description": "Display order within category (lower = first)",
            "minimum": 1
        },
        "imports": {
            "type": "array",
            "description": "Shared files to import from overlays/.shared/",
            "items": {
                "type": "string"
            },
            "default": []
        },
        "minimal": {
            "type": "boolean",
            "description": "Whether this overlay is excluded in minimal mode (true = extra/optional)",
            "default": false
        }
    },
    "additionalProperties": false
}
